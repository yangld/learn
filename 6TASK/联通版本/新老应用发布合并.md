### 联通和标准版应用管理合并
1. web端使用联通版本
2. 存储使用标准版
3. 合并接口, 同时支持联通版本和标准版
4. 逻辑
	1. 发布, 升级, 保存草稿,保存下架应用需要修改, 增加是否容器内, 安装位置, 是否使用附属签名字段
	2. 这三个字段, 即存储到package表中(老页面使用), 又存储到assAppPolicy中(新页面使用)
5. 数据库老数据升级步骤
	1. 备份package表
	2. 然后升级
	3. 然后根据备份的package,更新package表的inContainer, showLocation, additionalSign
	4. 然后根据备份的package, 生成assAppPolicy数据,并更新对应的appInfo表的securityPolicyId
6. 新数据生成
	1. 使用新版本的web, 生成后, 确定是否可用
	2. 使用联通版本的web, 查看上面生成的数据, 是否可用
7. 老数据升级后
	1. 使用新版本的web,  确定是否可用
	2. 使用联通版本的web, 是否可用
8. 步骤
	1. 代码修改
	2. 部署到测试环境
	3. 生成新数据, 验证标准版web端展示是否正确
	4. web端替换成联通版本, 验证web端展示是否正确
	5. 部署联通版本, 生成数据
	6. 按老数据升级步骤升级数据库和服务
	7. 验证联通版本web端展示是否正确
	8. 替换成标准版, 查看是否正确
9. 打包时机
	1. 标准版是服务端, 调用接口打包
	2. 联通版, 是web端调用打包
	3. web端,需要修改步骤, 修改为web端不打包, 服务端打包






### 联通升级
1. 升级前创建系统环境准备
	```
	root登录
	mkdir -p /home/emmjava
	拷贝deploy_app_dir到/home/emmjava
		
	/etc/init.d/downloadService stop
	/etc/init.d/assService stop
	rm -f /etc/init.d/downloadService
	rm -f /etc/init.d/assService
	修改root_install.sh, 注释掉install_mysql和install_redis的安装
	运行root_install.sh, 会创建emmjava用户
	切换到emmjava
	运行user_install_ext.sh openresty 安装openresty
	
	```
2. download和base, depmon, appmarket数据库支持自动升级, 不需要修改
3. appmanage数据库脚本
	1. 升级前备份
	``` 
	create table service_app_info_20220216 select * from service_app_info;
	create table ass_app_info_20220216 select * from ass_app_info;
	create table h5_info_20220216 select * from h5_info;
	```
	2. 升级前执行
	```
	alter table service_app_info drop un_allow_sandbox;
	alter table ass_app_info drop un_allow_sandbox;
	alter table service_app_info drop permission;
	
	ALTER table service_app_info add validate_time varchar(200) null;
	ALTER table service_app_info add portal_recommend varchar(200) null;
	ALTER table service_app_info add recommend varchar(200) null;
	ALTER table service_app_info add position varchar(200) null;
	ALTER table service_app_info add LEVEL varchar(200) null;
	ALTER table service_app_info add org_codes varchar(200) null;
	ALTER table service_app_info add has_att_signed varchar(200) null;
	ALTER table service_app_info add att_signed_unit varchar(200) null;
	ALTER table service_app_info add in_container varchar(200) null;
	ALTER table service_app_info add show_location varchar(200) null;
	ALTER table service_app_info add additional_sign varchar(200) null;
	delete from schema_version where version>=35;
	```
	3. 升级
		1. 修改install_ass.sh中的mysql和redis的用户名,密码,端口
		2. 执行升级过程
	4. 升级后恢复
	```	
	alter table service_app_info drop un_allow_sandbox;
	alter table ass_app_info drop un_allow_sandbox;
	alter table service_app_info drop permission;
	对比h5_info的前后变化
	```
4. 后续任务
	1. 重新打包
	2. 创造数据, 包括轻应用, 沙箱应用, 苹果应用等
	3. 按上面的步骤进行升级, 确定应用如何
	4. 修改问题
	5. 打包发布, 将发布包和升级手册发送给红雷
