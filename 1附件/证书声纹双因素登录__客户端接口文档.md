
## 登录认证管理器


### 设备端登录接口

证书双因素登录, 口令双因素登录, 声纹双因素登录, 使用该接口

#### URL

- `POST` /uni_auth/v1/login/gateway

描述：设备端登录接口，认证参数完整非对称加密加密

ContentType：`application/x-www-form-urlencoded;charset=UTF-8`

#### 请求参数

##### Query Parameter

| 名称                 | 类型   | 必填 | 描述                                                                                |
| -------------------- | ------ | ---- | ----------------------------------------------------------------------------------- |
| authenticationMethod | string | 是   | 登录方式   VPL: 声纹, CERT: 证书, PASSWORD: 口令                                    |
| vendor               | string | 是   | 登录方式厂商 706: 706项目声纹和证书登录的配置, PEKALL: 口令认证的配置               |
| parameters           | string | 是   | 证书:{   "plaintext": "plaintext",   "signedtext": "signed text",   "tsatext": "tsatext",   "cert": "cert",   "username": "yld02",   "imei": "imei",   "otptype": "otptype",   "otpnum": "otpnum" }, 口令: {   "userName": "yld02",   "password": "petest1111" } , 声纹: {  "account":"yld02", "personId": "yld02/test",   "snCode": "地区,方面,保护,显示,作为,政府" ,"fileId":"fff6e78debe84486cc18ac38febe"}                                                                 |
| ver                  | string | 否   | 版本号，用于支持parameters参数整体加密, 2: parameters整体需要解密                   |
| loginId              | string | 否   | 会话id，主要用于多因素认证, 双因素认证第二次认证时, 需要填写第一次认证返回的loginId |


#### 响应参数

| 名称 | 类型 | 必填 | 最大长度 | 描述 | 示例值 |
| --- | --- | --- | --- | --- | --- |
| any object | object | 否 | - | any object. |  |

#### 响应示例

```
{
    "errorCode": "AUTHENTICATION_METHOD_NOT_ENOUGH",
    "description": "认证方式不够。缺少:口令认证",
    "loginId": "a6104419d402404ca1b720c682fe1fc6",
    "nextAuthMethod": [
        "PASSWORD"
    ]
}
```

```
{
    "errorCode": "0",
    "description": "登录成功",
    "loginId": "7b5e3efc9e6a4f5aae73bfffbb336033",
    "name": "yld02",
    "account": "yld02",
    "mobilePhone": "15801509174",
    "idNum": null,
    "orgId": "14817de23736434f90ad9ece3983e15b",
    "orgCodeReal": "pka_tid_7__ada5ffc6-b741-4d72-bbb2-6736d50ed627",
    "tenantAccount": "yld02",
    "licenceStartTime": 1629878498197,
    "licenceEndTime": 1693497599000,
    "licenceDeviceTotal": 100,
    "licenceOrgTotal": 10000,
    "licenceUserTotal": 100000,
    "licenceAppTotal": 10000,
    "licenceDocTotal": 10000,
    "logoImageUrl": null,
    "backgroundImageUrl": null,
    "platformTitle": "11113333",
    "status": 51001,
    "funcIds": "1,2,4,6,8",
    "tenantId": "14817de23736434f90ad9ece3983e15b",
    "tenantOrgId": "14817de23736434f90ad9ece3983e15b",
    "opTenantId": 7,
    "tenantType": "normal",
    "tenantOrgName": "pka_tid_7__yld02",
    "tenantOrgDefCode": "00000000000000010000000000001000",
    "serviceInfos": [
        {
            "id": 22264,
            "tenantId": 7,
            "serviceId": 57,
            "name": "手势认证",
            "serviceCode": "SERVICE_PEKALL_PATTERN_AUTH",
            "createTime": "Jul 7, 2022 2:11:37 PM",
            "updateTime": "Jul 7, 2022 2:11:37 PM",
            "showOnPortal": 0,
            "functionInfoList": [
                {
                    "id": 30041,
                    "tenantId": 7,
                    "serviceId": 57,
                    "functionId": 56,
                    "functionCode": "FUNC_APP_PATTERN_AUTH",
                    "name": "APP端手势认证",
                    "description": "利用移动端的手势认证能力，采用密码技术，实现用户在服务器端的认证。",
                    "createTime": "Jul 7, 2022 2:11:37 PM",
                    "updateTime": "Jul 7, 2022 2:11:37 PM",
                    "appInfoList": [],
                    "selected": false
                }
            ],
            "selected": false
        }
    ]
}
```
#### 响应示例
```
{
    "errorCode": "VPL_SRV_AUTH_FAIL",
    "description": "声纹认证失败",
    "data": null
}
```

## 声纹认证管理器


### 设备申请开启声纹认证
开启声纹认证

#### URL

- `POST` /uni_auth/v1/vpl_auth/enable_vpl

描述：设备申请开启声纹认证, 返回sessionToken和personId

ContentType：`application/x-www-form-urlencoded;charset=UTF-8`

#### 请求参数

##### Query Parameter

| 名称                 | 类型   | 必填 | 描述                                          |
| -------------------- | ------ | ---- | --------------------------------------------- |
| loginId              | string | 是   | 登录后返回的loginId                           |
| authenticationMethod | string | 是   | 登录方式   PASSWORD: 口令                          |
| vendor               | string | 是   | 登录方式厂商 PEKALL |
| parameters           | string | 是   | {   "userName": "yld02",   "password": "pekalxxxx", "vendor":"706" }                            |
| ver                  | string | 否   | 版本号，用于支持parameters参数整体加密, 2: parameters整体需要解密                            |

#### 响应参数

| 名称 | 类型 | 必填 | 最大长度 | 描述 | 示例值 |
| --- | --- | --- | --- | --- | --- |
| any object | object | 否 | - | any object. |  |

#### 响应示例

```
{
    "status": "OK",
    "err": null,
    "errCode": null,
    "data": {
        "person_id": "yld02/test",
        "do_pass": null,
        "sn_code": null,
        "token": null,
        "sessionToken": "72abf5c8-61a2-4c88-8096-80aba136b3b8",
        "userDeviceStat": 0
    }
}
```

#### 响应示例
```
{
    "status": "Error",
    "err": "用户名或密码错误",
    "errCode": null,
    "data": null
}
```

```
{
    "status": "Error",
    "err": "管理员未启用声纹认证。如需使用，请联系管理员。",
    "errCode": null,
    "data": null
}
```

### 获取声纹验证码
获取声纹文本 根据开启后返回的personId获取

#### URL

- `GET` /uni_auth/v1/vpl_auth/voice_code

描述：获取声纹验证码
 获取声纹文本 根据开启后返回的personId获取

ContentType：`application/x-www-form-urlencoded;charset=UTF-8`

#### 请求参数

##### Query Parameter

| 名称     | 类型   | 必填 | 描述                                          |
| -------- | ------ | ---- | --------------------------------------------- |
| personId | string | 是   | 开启接口返回的personId                        |
| vendor   | string | 否   | 登录方式厂商 706: 706项目声纹 |

#### 响应参数

| 名称 | 类型 | 必填 | 最大长度 | 描述 | 示例值 |
| --- | --- | --- | --- | --- | --- |
| any object | object | 否 | - | any object. |  |

#### 响应示例

```
{
    "status": "OK",
    "err": "",
    "errCode": "",
    "data": {
        "person_id": "yld02-per",
        "do_pass": true,
        "sn_code": "111,222,333,444,555",
        "token": "serererere",
        "sessionToken": "72abf5c8-61a2-4c88-8096-80aba136b3b8",
        "userDeviceStat": 0
    }
}
```


### 注册声纹认证
声纹注册, 根据厂商, 注册声纹

#### URL

- `POST` /uni_auth/v1/vpl_auth/register_vpl

描述：注册声纹认证, 根据厂商参数, 注册到不同厂商的声纹的服务器中

ContentType：`application/x-www-form-urlencoded;charset=UTF-8`

#### 请求参数

##### Query Parameter

| 名称         | 类型   | 必填 | 描述                                          |
| ------------ | ------ | ---- | --------------------------------------------- |
| loginId      | string | 是   | 登录返回的loginId                            |
| sessionToken | string | 是   | 开启声纹认证返回的sessionToken                           |
| vendor       | string | 否   | 登录方式厂商 706: 706项目声纹 |
| fileIds      | string | 是   | 文件id列表，通过逗号分隔, 支持一个或多个                    |

#### 响应参数

| 名称 | 类型 | 必填 | 最大长度 | 描述 | 示例值 |
| --- | --- | --- | --- | --- | --- |
| any object | object | 否 | - | any object. |  |

#### 响应示例

```
{
    "status": "OK",
    "err": null,
    "errCode": null,
    "data": {
        "person_id": "yld02/test",
        "do_pass": null,
        "sn_code": null,
        "token": null,
        "sessionToken": "72abf5c8-61a2-4c88-8096-80aba136b3b8",
        "userDeviceStat": 0
    }
}
```


