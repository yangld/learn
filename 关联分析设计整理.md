	任务: 关联分析设计整理
	项目: 湖南省集中管控
	阶段: 详细设计
	输入: 代码
	输出: 设计文档, 未完成功能说明

1. 模块关系图
	![[模块关系图.jpg]]

2. cmc记录原始数据到kafka
	![[时序图.jpg]]

3. aa处理kafka原始数据,并生成事件数据到kafka
	![[AA时序图.jpg]]

4. cmc接收数据,并写入mysql, 并触发事件响应日志处理逻辑
	![[cmc接收事件 1.jpg]]
1. 数据数结构
	1. data_type_mapping 对应的是topic和data_type, 并含有convert
		1. 负责找到data_type, 并初步转化kafka的数据,一般不转化, vpn的需要转化
	2. associ_analysis_rule_group 有开关, object_type
		1. 开关
	3. associ_analysis_rule_group 有data_type, analyzer_calss, rule_group_id, message_tamplate
		1. 根据date_type,rule_group_id获取解析器, 解析,如果有问题,则将消息放到kafka中
	4. associ_analysis_event
		1. object_id, object_name, evet_object_type, event_type, log_id, message, occur_time, terminalid,terminal_name, user_id,user_name,confirmation_status

```mermaid
erDiagram
	ACTION  		        ||--|{ 	MdmDeviceInfo	: one-to-many
	MdmDeviceInfo			||--|{ 	MdmUser			: many-to-one
	MdmUser					||--|{ 	FamTelWhiteInfo	: one-to-many
	
	MdmPolicyTemplate	||--|{ 	BluetoothWhiteGroupPolicy:one-to-many
	BluetoothWhiteGroupPolicy}|--||BluetoothWhiteGroupInfo: many-to-one
    BluetoothWhiteGroupInfo ||--|{ BluetoothWhiteInfo	: one-to-many

	MdmPolicyTemplate		||--|{ WorkTelWhiteGroupPolicy: one-to-many
	WorkTelWhiteGroupPolicy	}|--|| WorkTelWhiteGroupInfo: many-to-one
    WorkTelWhiteGroupInfo 	||--|{ WorkTelWhiteInfo	: one-to-many
	
	WorkTelWhiteGroupInfo 	||--|{ WorkTelWhiteTotalInfo: one-to-many
	WorkTelWhiteInfo 		||--|| WorkTelWhiteTotalInfo: one-to-one
	
	MdmPolicyTemplate		||--|{ FamTelWhiteGroupPolicy: one-to-many
	
	MdmUser 				||--|{ FamTelWhiteTotalInfo: one-to-many
	FamTelWhiteInfo 		||--|| FamTelWhiteTotalInfo: one-to-one
	
	ACTION {
		string code
		string name
                    string description
		            string id
	}
	
	BluetoothWhiteGroupPolicy {
	    string bluetoothWhiteGroupId
	    string policyId
        string policyGroupId
		string id
    }
	BluetoothWhiteGroupInfo {
        string name
		string description
    }
	BluetoothWhiteInfo {
	    string groupId
		string name
		string mac
    }
	
	WorkTelWhiteGroupPolicy {
	    string whiteGroupId
	    string policyId
        string policyGroupId
		string id
    }
	WorkTelWhiteGroupInfo {
        string name
		string description
    }
	WorkTelWhiteInfo {
	    string groupId
		string linkman
		string tel
    }
	
	FamTelWhiteInfo {
	    string userId
		string linkman
		string tel
    }
	
	
	FamTelWhiteGroupPolicy {
	    boolean useFamTel
	    string policyId
        string policyGroupId
		string id
    }
```



2. 任务完成情况
	1. 未完成功能
		1. vpn日志的接收逻辑, 跟姜睿确认, vpn日志之前是从syslog中获取,然后放到kafka中
	2. 已完成功能
		1. 查看AA代码逻辑并修改
		2. 查看cmc的逻辑, 支持用户登录日志进kafka
		3. 修改AA使用的mysql版本为8.0
		4. 将AA功能移动到cmc_info_server中
		5. 修改打包脚本,将AA逻辑增加到打包逻辑中
		6. 在150上进行基本功能测试,生成数据完成,可以开始测试