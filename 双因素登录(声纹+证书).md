
## 首次密码登录
1. 用户离线获取到用户名,密码和证书签约码
2. 用户在客户端输入用户名, 密码, 证书签约码 ,点击登录按钮
3. 服务端会生成证书,绑定证书和用户, 返回用户登录信息和证书
4. 客户端记录用户名, 证书ID, 证书及关系

## 非首次密码登录
1. 前提: 客户端已经有证书
2. 用户离线获取到用户名,密码
3. 用户在客户端输入用户名, 密码, 点击登录按钮
4. 服务端进行登录, 返回用户登录信息

## 声纹登录
1. 前提: 客户端已经有证书, 并且用户已经申请了认证认证
2. 用户离线获取到用户名
3. 用户在客户端输入用户名, 获取声纹登录文本内容
4. 用户点击录制按钮, 录制声音信息,录制完成后,再次点击录制按钮,停止录制声音
5. 客户端,将声音信息和用户名,发送到服务器
6. 服务端进行声纹认证,认证成功后,返回需要证书认证
7. 客户端, 使用证书进行证书登录,登录成功后,返回用户登录信息

## 个人中心
1. 前提:  用户已登录客户端
2. 客户端个人中心,可以查看申请的证书基本信息和声纹基本信息
3. 客户端个人中心,可以申请声纹

## 申请声纹
1. 前提:  用户已登录客户端
2. 客户端获取声纹申请文本内容
3. 用户点击录制按钮, 录制声音信息,录制完成后,再次点击录制按钮,停止录制声音
4. 客户端,将声音信息和登录会话ID,发送到服务器
5. 服务端进行声纹申请, 申请成功后,返回声纹基本信息

## 相关文档
![[证书认证.vpp]]
![[服务端与证书服务器接口文档(包含).docx]]
![[服务端与声纹服务器端接口文档.docx]]
![[声纹认证.vpp]]

http://192.168.11.34/index.php?m=story&f=view&storyID=493

支持认证和声纹的租户级配置
支持多种认证和声纹的配置
双因素认证, 需要服务端保证, 设计文档体现

与玉强再次确认一下, 证书内容是否在uas中有留存

客户端要有声纹注销的功能
	关闭及注销
培育和张乐,明确改动内容
	培育客户端需要进行哪些变更工作
	web端, 证书和声纹信息管理页面, 需要有, 明确一下web端的样子, 变更内容


## 现有逻辑
1. 运营中, 有声纹认证服务, 只有一个服务,一个功能
	1. 后续,需要修改功能code, 不同的厂家,对应不同的code
	2. 声纹的注册和验证, 都和这个code有关,对应不同的逻辑
	3. 切换声纹厂商,会将历史中的声纹都清除, 需谨慎操作
2. 运营中,没有证书认证服务
	1. 需要增加证书认证服务, 不同的厂商,对应不同的功能code
	2. 切换厂商,会清除历史中的证书, 需谨慎操作
	3. 证书的注册和验证,都和这个code有关,对应不同的逻辑
	4. 需要再部署脚本中, 增加该服务的添加脚本
	5. 当开启了证书认证,则支持证书的双因素认证, 主登录之后,进行证书的双因素认证
	6. 是否会与已有的双因素认证冲突, 还是只是绑定声纹认证
3. 双因素认证原理
	1. 证书认证,需要增加一个loginType为Cert, vendor为xxx的类, 参考SuresecCertLoginMechanism, 主要是修改login逻辑, Cert是支持作为主认证的
	2. 在证书认证的时候, 传递loginType,vendor
	3. 声纹认证,需要增加一个loginType为VPL, vendor为xxx的类, 参考VplLoginMechanism
4. 登录有几件事要做
	1. 会话管理,将会话信息,写入session中
	2. 按不同的方式,验证用户是否登录成功
	3. 判断用户是否锁定, 锁定和解锁
	4. 