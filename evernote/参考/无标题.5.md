
1.  安装ES
    1.  修改install\_ext.sh，安装es为684版本
 install\_elasticsearch() {
 echo Install elasticsearch ...

 java\_version=$(java -version 2>&1 |head -n 1|sed -n '/\\b1\\.8\\..\*/p')
 if \[ -z "$java\_version" \];then
 java -version
 echo 'Elasticsearch need java 8!'
 exit -1
 fi

 software\_dir=../../ext\_soft
 yum -y install ${software\_dir}/yum/elasticsearch-6.8.4.rpm
 limits\_conf=/etc/security/limits.conf
 if \[ \`grep -c "\* soft nproc 2048" $limits\_conf\` -eq '0' \]; then
 echo "\* soft nproc 2048" >> $limits\_conf
 fi
 if \[ \`grep -c "\* hard nproc 4096" $limits\_conf\` -eq '0' \]; then
 echo "\* hard nproc 4096" >> $limits\_conf
 fi
 sed -i "s/1024/2048/" /etc/security/limits.d/20-nproc.conf
 elasticsearch\_yml=/etc/elasticsearch/elasticsearch.yml
 if \[ \`grep -c "network.host: 0.0.0.0" $elasticsearch\_yml\` -eq '0' \]; then
 echo "network.host: 0.0.0.0" >> $elasticsearch\_yml
 fi
 if \[ \`grep -c "bootstrap.system\_call\_filter: false" $elasticsearch\_yml\` -eq '0' \]; then
 echo "bootstrap.system\_call\_filter: false" >> $elasticsearch\_yml
 fi

 # 开机自启动需要设置JAVA\_HOME
 sed -i "s:^#JAVA\_HOME=.\*$:JAVA\_HOME=${JAVA\_HOME}:" /etc/sysconfig/elasticsearch
 cp -rf ../../app\_conf/es/elasticsearch  /etc/init.d

 systemctl enable elasticsearch
 systemctl start elasticsearch
 echo "sleep 10s waiting for elasticsearch start....."
 sleep 10

 check\_es\_stat

 echo Install elasticsearch OK!

 cd ../../app\_conf/es/es-template/
 ./es-init-template.sh
 cd -
}

1.  修改es-template中的文件

![[./_resources/无标题.5.resources/es-template.gz]]
49.  配置ES，增加认证
    1.  cd /usr/share/elasticsearch/
    2.  bin/elasticsearch-keystore create
    3.  bin/elasticsearch-setup-passwords auto
    4.  service elasticsearch stop
    5.  ==bin/elasticsearch-users useradd my\_admin -p my\_password -r superuser==
    6.  curl -u my\_admin -XPUT '[http://localhost:9200/\_xpack/security/user/elastic/\_password?pretty](http://localhost:9200/_xpack/security/user/elastic/_password?pretty)' -H 'Content-Type: application/json' -d' {"password" : "new\_password"}'
    7.  service elasticsearch start
    8.  curl -v -u elastic:wp5xW31V1Sae5ws9r58L  <http://localhost:9200>

    Created at: 2019-12-06T16:05:55+08:00
    Updated at: 2019-12-12T14:22:37+08:00

