---
up:: [[2023-03]]
prev:: [[2023-03-23]]
next:: [[2023-03-25]]
---

```dataview
list
from "3工作日志/日志"
where
contains(file.name, "2023-03-24-")
sort file.ctime
```
1. 国家集中管控，导出功能开发

## 可web端登录服务修改内容
### 统一认证数据库
增加权限数据
INSERT INTO uniauth.fineauthperm
(id, module, category, menu, code, name, type, seq)
VALUES(626, 'pack', '', '', 'all', '所有', 'read', 12119);

增加权限typeCode关系
INSERT INTO uniauth.fineauthpermrelation
(id, typecode, type, rightid)
VALUES(626, 'packcode', 'service', 626);

增加typeCode
INSERT INTO uniauth.servicecodepackagemap
(id, code, packagename)
VALUES(11, 'packcode', 'com.pekall.package.webapp');

### 运营数据库
增加typeCode
INSERT INTO cloudoperationserver.servicecodepackagemap
(id, code, packagename)
VALUES(7, 'pack_code', 'com.pekall.package.webapp');

### 新增服务
用户创建对应的webapp
!/bin/bash

set -xe

uasurl="https://uas.pekall.com:4434"

createwebauthority() {
appName=$1
appIdentifier=$2
appVersion=$3
description=$4

curl -k -i -X POST -b /tmp/cookie.txt \
-d appName=$appName \
-d appIdentifier=$appIdentifier \
-d appVersion=$appVersion \
-d description=$description \
${uasurl}/uniauth/v1/applications
}

source /etc/profile

./uasadminlogingetcookie.sh https://uas.pekall.com:4434
createwebauthority 打包服务 com.pekall.package.webapp v1.0 打包服务

rm -rf /tmp/cookie.txt

echo
echo 'post script done!'

### 过程
1. 脚本添加webApp
2. 数据库脚本添加运营和统一认证的基础数据，包括权限信息和typeCode及webApp包名
3. 脚本添加打包服务
4. 编辑或新增租户，选中打包服务
5. 运营会创建webApp的授权记录
6. 运营会创建对应的管理员


