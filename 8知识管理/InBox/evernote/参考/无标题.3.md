
curl '[http://192.168.11.153:9200/pekall-dev-app-log-\*/\_search?size=0](http://192.168.11.153:9200/pekall-dev-app-log-*/_search?size=0)' -H 'Accept: application/json, text/javascript, \*/\*; q=0.01' -H 'Origin: chrome-[[extension://ffmkiejjmecolpfloofpjologoblkegm | extension://ffmkiejjmecolpfloofpjologoblkegm]]' -H 'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10\_14\_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36' -H 'Content-Type: application/json' --data-binary '{"query":{"bool":{"must":\[{"range":{"startTime":{"gte":"0","lte":"1865107199000"}}}\]}},"aggs":{"usage\_distribution":{"terms":{"field":"appId","size":2147483647},"aggs":{"sum\_duration":{"sum":{"field":"duration"}},"sum\_traffic":{"sum":{"field":"dataTraffic"}}}}}}' --compressed —insecure

"query":{"bool":{"must":\[{"range":{"startTime":{"gte":"0","lte":"1965107199000"}}},{“terms":{“appPackageName”:\[“com.pekall.emdm"\]}}\]}},

curl '[http://localhost:9200/pekall-dev-sys-app-log-\*/\_search?size=10&pretty](http://localhost:9200/pekall-dev-sys-app-log-*/_search?size=0&pretty)' -H 'Accept: application/json, text/javascript, \*/\*; q=0.01' -H 'Content-Type: application/json' --data-binary '{"query":{"bool":{"must":\[{"range":{"startTime":{"gte":"0","lte":"1965107199000"}}},{"terms":{"appPackageName":\["com.pekall.emdm"\]}}\]}},"aggs":{"usage\_distribution":{"terms":{"field":"orgName","size":2147483647},"aggs":{"sum\_duration":{"sum":{"field":"duration"}}}}}}' > ae.txt

curl '[http://localhost:9200/pekall-dev-sys-app-log-2019-01,pekall-dev-sys-app-log-2019-02,pekall-dev-sys-app-log-2019-03,pekall-dev-sys-app-log-2019-04/\_search?size=0&pretty](http://localhost:9200/pekall-dev-sys-app-log-*/_search?size=0&pretty)' -H 'Accept: application/json, text/javascript, \*/\*; q=0.01' -H 'Content-Type: application/json' --data-binary '{"query":{"bool":{"must":\[{"terms":{"appPackageName":\["com.pekall.emdm"\]}}\]}},"aggs":{"usage\_distribution":{"terms":{"field":"orgName","size":2147483647},"aggs":{"sum\_duration":{"sum":{"field":"duration"}}}}}}' > ae.txt

curl '[http://localhost:9200/pekall-dev-sys-app-log-2019-01,pekall-dev-sys-app-log-2019-02,pekall-dev-sys-app-log-2019-03,pekall-dev-sys-app-log-2019-04/\_search?size=0&pretty](http://localhost:9200/pekall-dev-sys-app-log-*/_search?size=0&pretty)' -H 'Accept: application/json, text/javascript, \*/\*; q=0.01' -H 'Content-Type: application/json' --data-binary '{"query":{"bool":{"must":\[{"terms":{"appPackageName":\["com.pekall.emdm"\]}}\]}},"aggs":{"usage\_distribution":{"terms":{"field”:"orgCode","size":2147483647},"aggs":{"sum\_duration":{"sum":{"field":"duration"}}}}}}' > ae.txt

curl '[http://localhost:9200/pekall-dev-sys-app-log-2019-01,pekall-dev-sys-app-log-2019-02,pekall-dev-sys-app-log-2019-03,pekall-dev-sys-app-log-2019-04/\_search?size=0&pretty](http://localhost:9200/pekall-dev-sys-app-log-2019-01,pekall-dev-sys-app-log-2019-02,pekall-dev-sys-app-log-2019-03,pekall-dev-sys-app-log-2019-04/_search?size=0&pretty)' -H 'Accept: application/json, text/javascript, \*/\*; q=0.01' -H 'Content-Type: application/json' --data-binary '{"query":{"bool":{"must":\[{"terms":{"appPackageName":\["com.pekall.emdm"\]}}\]}},"aggs":{"usage\_distribution":{"terms":{"field":"orgCode","size":2147483647},"aggs":{"sum\_duration":{"sum":{"field":"duration"}}}}}}' > ae.txt

cat ae.txt | grep 'key\\|value' > af.txt

cat af.txt | awk -F ':' '{print  $2 $3}' | awk -F '\\"' '{print $2   $5}' > ag.txt

create table mdm\_org\_temp2 as select a.def\_code\_real par\_code, a.abbreviation par\_abb, b.def\_code\_real ,b.abbreviation abb, [b.id](http://b.id/) id, b.org\_code\_real
from
(select def\_code\_real, abbreviation from mdm\_org ) a,
(
select substr(def\_code\_real,1,48) par, def\_code\_real, abbreviation ,id, org\_code\_real from mdm\_org  order by def\_code\_real) b where a.def\_code\_real = b.par;

create table \`duration\_temp\` (\`org\_code\` varchar(200), \`duration\` bigint(20));

curl '[http://localhost:9200/pekall-dev-sys-app-log-2019-01/\_search?size=0&pretty](http://localhost:9200/pekall-dev-sys-app-log-2019-01,pekall-dev-sys-app-log-2019-02,pekall-dev-sys-app-log-2019-03,pekall-dev-sys-app-log-2019-04/_search?size=0&pretty)' -H 'Accept: application/json, text/javascript, \*/\*; q=0.01' -H 'Content-Type: application/json' --data-binary '{"query":{"bool":{"must":\[{"terms":{"appPackageName":\["com.pekall.emdm"\]}}\]}},"aggs":{"usage\_distribution":{"terms":{"field":"orgCode","size":2147483647},"aggs":{"sum\_duration":{"sum":{"field":"duration"}}}}}}' > a1.txt

curl '[http://localhost:9200/pekall-dev-sys-app-log-2019-02/\_search?size=0&pretty](http://localhost:9200/pekall-dev-sys-app-log-2019-01,pekall-dev-sys-app-log-2019-02,pekall-dev-sys-app-log-2019-03,pekall-dev-sys-app-log-2019-04/_search?size=0&pretty)' -H 'Accept: application/json, text/javascript, \*/\*; q=0.01' -H 'Content-Type: application/json' --data-binary '{"query":{"bool":{"must":\[{"terms":{"appPackageName":\["com.pekall.emdm"\]}}\]}},"aggs":{"usage\_distribution":{"terms":{"field":"orgCode","size":2147483647},"aggs":{"sum\_duration":{"sum":{"field":"duration"}}}}}}' > a2.txt

curl '[http://localhost:9200/pekall-dev-sys-app-log-2019-03/\_search?size=0&pretty](http://localhost:9200/pekall-dev-sys-app-log-2019-01,pekall-dev-sys-app-log-2019-02,pekall-dev-sys-app-log-2019-03,pekall-dev-sys-app-log-2019-04/_search?size=0&pretty)' -H 'Accept: application/json, text/javascript, \*/\*; q=0.01' -H 'Content-Type: application/json' --data-binary '{"query":{"bool":{"must":\[{"terms":{"appPackageName":\["com.pekall.emdm"\]}}\]}},"aggs":{"usage\_distribution":{"terms":{"field":"orgCode","size":2147483647},"aggs":{"sum\_duration":{"sum":{"field":"duration"}}}}}}' > a3.txt

curl '[http://localhost:9200/pekall-dev-sys-app-log-2019-04/\_search?size=0&pretty](http://localhost:9200/pekall-dev-sys-app-log-2019-01,pekall-dev-sys-app-log-2019-02,pekall-dev-sys-app-log-2019-03,pekall-dev-sys-app-log-2019-04/_search?size=0&pretty)' -H 'Accept: application/json, text/javascript, \*/\*; q=0.01' -H 'Content-Type: application/json' --data-binary '{"query":{"bool":{"must":\[{"terms":{"appPackageName":\["com.pekall.emdm"\]}}\]}},"aggs":{"usage\_distribution":{"terms":{"field":"orgCode","size":2147483647},"aggs":{"sum\_duration":{"sum":{"field":"duration"}}}}}}' > a4.txt

\[root@unilog ~\]# cat ae.txt | grep 'key\\|value' > af.txt
\[root@unilog ~\]# cat a1.txt | grep 'key\\|value' > a11.txt
\[root@unilog ~\]# cat a2.txt | grep 'key\\|value' > a22.txt
\[root@unilog ~\]# cat a3.txt | grep 'key\\|value' > a33.txt
\[root@unilog ~\]# cat a4.txt | grep 'key\\|value' > a44.txt

\[root@unilog ~\]# cat a11.txt | awk -F ':' '{print  $2 $3}' | awk -F '\\"' '{print $2   $5}' > a111.txt
\[root@unilog ~\]# cat a111.txt | less
\[root@unilog ~\]# cat a22.txt | awk -F ':' '{print  $2 $3}' | awk -F '\\"' '{print $2   $5}' > a222.txt
\[root@unilog ~\]# cat a33.txt | awk -F ':' '{print  $2 $3}' | awk -F '\\"' '{print $2   $5}' > a333.txt
\[root@unilog ~\]# cat a44.txt | awk -F ':' '{print  $2 $3}' | awk -F '\\"' '{print $2   $5}' > a444.txt

create table \`duration\_temp1\` (\`org\_code\` varchar(200), \`duration\` bigint(20));

create table \`duration\_temp2\` (\`org\_code\` varchar(200), \`duration\` bigint(20));

create table \`duration\_temp3\` (\`org\_code\` varchar(200), \`duration\` bigint(20));

create table \`duration\_temp4\` (\`org\_code\` varchar(200), \`duration\` bigint(20));

select a.par\_abb,mon1,mon2,mon3,mon4 from 

(select par\_abb,sum(duration) as mon1 from mdm\_org\_temp2 t ,duration\_temp1 d where t.org\_code\_real=d.org\_code  group by par\_abb order by par\_abb) a,

(select par\_abb,sum(duration) as mon2 from mdm\_org\_temp2 t ,duration\_temp2 d where t.org\_code\_real=d.org\_code  group by par\_abb order by par\_abb) b,

(select par\_abb,sum(duration) as mon3 from mdm\_org\_temp2 t ,duration\_temp3 d where t.org\_code\_real=d.org\_code  group by par\_abb order by par\_abb) c,

(select par\_abb,sum(duration) as mon4 from mdm\_org\_temp2 t ,duration\_temp4 d where t.org\_code\_real=d.org\_code  group by par\_abb order by par\_abb) d where a.par\_abb = b.par\_abb and a.par\_abb=c.par\_abb and a.par\_abb=d.par\_abb;

curl '[http://localhost:9200/pekall-dev-sys-app-log-2019-\*/\_search?size=0&pretty](http://localhost:9200/pekall-dev-sys-app-log-2019-01,pekall-dev-sys-app-log-2019-02,pekall-dev-sys-app-log-2019-03,pekall-dev-sys-app-log-2019-04/_search?size=0&pretty)' -H 'Accept: application/json, text/javascript, \*/\*; q=0.01' -H 'Content-Type: application/json' --data-binary '{"query":{"bool":{"must":\[{"terms":{"appPackageName":\["com.pekall.emdm"\]}}\]}},"aggs":{"usage\_distribution":{"terms":{"field":"orgName","size":2147483647},"aggs":{"sum\_duration":{"sum":{"field":"duration"}}}}}}' > a5.txt

create table \`duration\_temp5\` (\`org\_code\` varchar(200), \`duration\` bigint(20));

select par\_abb,sum(duration) as mon1 from mdm\_org\_temp2 t ,duration\_temp5 d where t.org\_code\_real=d.org\_code  group by par\_abb order by par\_abb

{ "query":{ "bool": { "filter": { "terms": { "\_id": \["4eb66d807b924e4eaad5855b164bd694"\] } } } }}

    Created at: 2019-11-19T11:45:03+08:00
    Updated at: 2019-11-26T10:29:56+08:00

